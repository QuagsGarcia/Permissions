acetoDisc = {
	["760161015211229234"] = {
		"guperm.weather",
		"gu.staff",
		"command.doorlock",
		"vMenu.VehicleOptions.VOFlares",
		"vMenu.VehicleOptions.VOPlaneBombs",
		
		
		
		"vMenu.VehicleSpawner.Super",
		
		"vMenu.VehicleSpawner.Industrial",
		"vMenu.VehicleSpawner.Utility",
		
		
		"vMenu.VehicleSpawner.Helicopters",
		"vMenu.VehicleSpawner.Planes",
		"vMenu.VehicleSpawner.Service",
		"vMenu.VehicleSpawner.Emergency",
		"vMenu.VehicleSpawner.Military",
		"vMenu.VehicleSpawner.Commercial",
		"vMenu.MiscSettings.ShowCoordinates",
		"vMenu.MiscSettings.PlayerBlips",
		"vMenu.MiscSettings.OverheadNames",
		
	},
	["1240048131643543604"] = {
		"doorlock.7709"
	},
	["1019824874165907496"] = {
		"doorlock.gu"
	},
	["1239091091924582450"] = {
		"doorlock.bobcat"
	},
	["807762603384111114"] = {
		"vMenu.OnlinePlayers.Menu",
		"vMenu.PlayerOptions.Menu",
		"vMenu.PlayerOptions.UnlimitedStamina", 
		"vMenu.PlayerOptions.NeverWanted",
		"vMenu.PlayerOptions.Ignored",
		"vMenu.PlayerOptions.CleanPlayer",
		"vMenu.PlayerOptions.DryPlayer",
		"vMenu.PlayerOptions.WetPlayer",
		"vMenu.VehicleOptions.Menu",
		"vMenu.VehicleOptions.KeepClean",
		"vMenu.VehicleOptions.Repair",
		"vMenu.VehicleOptions.Wash",
		"vMenu.VehicleOptions.ChangePlate",
		"vMenu.VehicleOptions.Mod",
		"vMenu.VehicleOptions.Colors",
		"vMenu.VehicleOptions.Liveries",
		"vMenu.VehicleOptions.Components",
		"vMenu.VehicleOptions.Doors",
		"vMenu.VehicleOptions.Windows",
		"vMenu.VehicleOptions.CycleSeats",
		"vMenu.VehicleOptions.EngineAlwaysOn",
		"vMenu.VehicleOptions.NoHelmet",
		"vMenu.VehicleOptions.Lights",
		"vMenu.VehicleOptions.FixOrDestroyTires",
		"vMenu.VehicleOptions.Underglow",
		"vMenu.VehicleSpawner.Menu",
		"vMenu.VehicleSpawner.DisableReplacePrevious",
		"vMenu.VehicleSpawner.SpawnByName",
		"vMenu.VehicleSpawner.Compacts",
		"vMenu.VehicleSpawner.Sedans",
		"vMenu.VehicleSpawner.SUVs",
		"vMenu.VehicleSpawner.Coupes",
		"vMenu.VehicleSpawner.Muscle",
		"vMenu.VehicleSpawner.SportsClassic",
		"vMenu.VehicleSpawner.Sports",
		"vMenu.VehicleSpawner.Motorcycles",
		"vMenu.VehicleSpawner.OffRoad",
		"vMenu.VehicleSpawner.Vans",
		"vMenu.VehicleSpawner.Cycles",
		"vMenu.VehicleSpawner.Boats",
		"vMenu.SavedVehicles.Menu",
		"vMenu.SavedVehicles.Spawn",
		"vMenu.PlayerAppearance.Menu",
		"vMenu.PlayerAppearance.Customize",
		"vMenu.PlayerAppearance.SpawnSaved",
		"vMenu.PlayerAppearance.SpawnNew",
		"vMenu.WeaponOptions.Menu",
		"vMenu.WeaponOptions.Spawn",
		"vMenu.WeaponLoadouts.Menu",
		"vMenu.WeaponLoadouts.All",
		"vMenu.MiscSettings.RestoreAppearance",
		"vMenu.WeaponOptions.PetrolCan",
		"vMenu.WeaponOptions.Parachute",
		"vMenu.WeaponOptions.PoolCue",
		"vMenu.WeaponOptions.AcidPackage",
		"vMenu.WeaponOptions.CandyCane",
		"vMenu.WeaponOptions.PistolXM3",
		"vMenu.WeaponOptions.FertilizerCan",
		"vMenu.WeaponOptions.Wrench",
		"vMenu.WeaponOptions.SwitchBlade",
		"vMenu.WeaponOptions.Snowball",
		"vMenu.WeaponOptions.Knife",
		"vMenu.WeaponOptions.KnuckleDuster",
		"vMenu.WeaponOptions.Hatchet",
		"vMenu.WeaponOptions.Hammer",
		"vMenu.WeaponOptions.GolfClub",
		"vMenu.WeaponOptions.Flashlight",
		"vMenu.WeaponOptions.FireExtinguisher",
		"vMenu.WeaponOptions.Dagger",
		"vMenu.WeaponOptions.Crowbar",
		"vMenu.WeaponOptions.Bottle",
		"vMenu.WeaponOptions.Bat",
		"vMenu.WeaponOptions.Ball",
		"vMenu.WeaponOptions.Pistol",
		"vMenu.WeaponOptions.PumpShotgun",
		"vMenu.WeaponOptions.SNSPistol",
	},
	["1189018056526135296"] = {
		"vMenu.WeaponOptions.APPistol",
		"vMenu.WeaponOptions.MicroSMG",
		"vMenu.WeaponOptions.MiniSMG",
		"vMenu.WeaponOptions.MachinePistol",
		"vMenu.WeaponOptions.TecPistol",
	},
	["1189017894479204403"] = {
		"vMenu.WeaponOptions.APPistol",
		"vMenu.WeaponOptions.MicroSMG",
		"vMenu.WeaponOptions.MiniSMG",
		"vMenu.WeaponOptions.MachinePistol",
		"vMenu.WeaponOptions.TecPistol",
		"vMenu.WeaponOptions.AssaultShotgun",
		"vMenu.WeaponOptions.HeavyShotgun",
		"vMenu.WeaponOptions.SweeperShotgun"
	},
	["807762818588999690"] = {
		"vMenu.WeaponOptions.APPistol",
		"vMenu.WeaponOptions.MicroSMG",
		"vMenu.WeaponOptions.MiniSMG",
		"vMenu.WeaponOptions.MachinePistol",
		"vMenu.WeaponOptions.TecPistol",
		"vMenu.WeaponOptions.AssaultShotgun",
		"vMenu.WeaponOptions.HeavyShotgun",
		"vMenu.WeaponOptions.SweeperShotgun",
		"vMenu.WeaponOptions.AssaultRifle",
		"vMenu.WeaponOptions.AssaultRifleMk2",
		"vMenu.WeaponOptions.SniperRifle",
		"vMenu.WeaponOptions.MarksmanRifle",
		"vMenu.WeaponOptions.MarksmanRifleMk2",
		"vMenu.WeaponOptions.Gusenberg",
		"vMenu.WeaponOptions.TacticalRifle",
	},
	["807762869532885033"] = { -- knox county
		"radio.rto",
		"duty.toggle",
		"gu.jail",
		"doorlock.leo",
		"vMenu.WeaponOptions.StunGun",
		"vMenu.WeaponOptions.CombatPistol",
		"vMenu.WeaponOptions.CarbineRifle",
		"vMenu.WeaponOptions.PumpShotgun",
		"vMenu.WeaponOptions.Flashlight",
		"vMenu.WeaponOptions.Nightstick",
		"vMenu.VehicleSpawner.Emergency",
	},
	["789550557043228724"] = { -- knoxville
		"radio.rto",
		"duty.toggle",
		"gu.jail",
		"doorlock.leo",
		"vMenu.WeaponOptions.StunGun",
		"vMenu.WeaponOptions.CombatPistol",
		"vMenu.WeaponOptions.CarbineRifle",
		"vMenu.WeaponOptions.PumpShotgun",
		"vMenu.WeaponOptions.Flashlight",
		"vMenu.WeaponOptions.Nightstick",
		"vMenu.VehicleSpawner.Emergency",
	},
	["807763598830075915"] = { -- fire
		"radio.rto",
	},
	["807763126195453953"] = { -- ems
		"radio.rto",
	},
	["807778114922348564"] = { -- Certified Civilian
		"radiocar.use"
	},
}
weaponpermtbl = {
	["vMenu.WeaponOptions.APPistol"] = "weapon_appistol",
	["vMenu.WeaponOptions.AdvancedRifle"] = "weapon_advancedrifle",
	["vMenu.WeaponOptions.AssaultRifle"] = "weapon_assaultrifle",
	["vMenu.WeaponOptions.AssaultRifleMk2"] = "weapon_assaultrifle_mk2",
	["vMenu.WeaponOptions.AssaultSMG"] = "weapon_assaultsmg",
	["vMenu.WeaponOptions.AssaultShotgun"] = "weapon_assaultshotgun",
	["vMenu.WeaponOptions.BZGas"] = "weapon_bzgas",
	["vMenu.WeaponOptions.Ball"] = "weapon_ball",
	["vMenu.WeaponOptions.Bat"] = "weapon_bat",
	["vMenu.WeaponOptions.BattleAxe"] = "weapon_battleaxe",
	["vMenu.WeaponOptions.Bottle"] = "weapon_bottle",
	["vMenu.WeaponOptions.BullpupRifle"] = "weapon_bullpuprifle",
	["vMenu.WeaponOptions.BullpupRifleMk2"] = "weapon_bullpuprifle_mk2",
	["vMenu.WeaponOptions.BullpupShotgun"] = "weapon_bullpupshotgun",
	["vMenu.WeaponOptions.CarbineRifle"] = "weapon_carbinerifle",
	["vMenu.WeaponOptions.CarbineRifleMk2"] = "weapon_carbinerifle_mk2",
	["vMenu.WeaponOptions.CombatMG"] = "weapon_combatmg",
	["vMenu.WeaponOptions.CombatMGMk2"] = "weapon_combatmg_mk2",
	["vMenu.WeaponOptions.CombatPDW"] = "weapon_combatpdw",
	["vMenu.WeaponOptions.CombatPistol"] = "weapon_combatpistol",
	["vMenu.WeaponOptions.CompactGrenadeLauncher"] = "weapon_compactlauncher",
	["vMenu.WeaponOptions.CompactRifle"] = "weapon_compactrifle",
	["vMenu.WeaponOptions.Crowbar"] = "weapon_crowbar",
	["vMenu.WeaponOptions.Dagger"] = "weapon_dagger",
	["vMenu.WeaponOptions.DoubleAction"] = "weapon_doubleaction",
	["vMenu.WeaponOptions.DoubleBarrelShotgun"] = "weapon_dbshotgun",
	["vMenu.WeaponOptions.FireExtinguisher"] = "weapon_fireextinguisher",
	["vMenu.WeaponOptions.Firework"] = "weapon_firework",
	["vMenu.WeaponOptions.Flare"] = "weapon_flare",
	["vMenu.WeaponOptions.FlareGun"] = "weapon_flaregun",
	["vMenu.WeaponOptions.Flashlight"] = "weapon_flashlight",
	["vMenu.WeaponOptions.GolfClub"] = "weapon_golfclub",
	["vMenu.WeaponOptions.Grenade"] = "weapon_grenade",
	["vMenu.WeaponOptions.GrenadeLauncher"] = "weapon_grenadelauncher",
	["vMenu.WeaponOptions.GrenadeLauncherSmoke"] = "weapon_grenadelauncher_smoke",
	["vMenu.WeaponOptions.Gusenberg"] = "weapon_gusenberg",
	["vMenu.WeaponOptions.Hammer"] = "weapon_hammer",
	["vMenu.WeaponOptions.Hatchet"] = "weapon_hatchet",
	["vMenu.WeaponOptions.HeavyPistol"] = "weapon_heavypistol",
	["vMenu.WeaponOptions.HeavyShotgun"] = "weapon_heavyshotgun",
	["vMenu.WeaponOptions.HeavySniper"] = "weapon_heavysniper",
	["vMenu.WeaponOptions.HeavySniperMk2"] = "weapon_heavysniper_mk2",
	["vMenu.WeaponOptions.HomingLauncher"] = "weapon_hominglauncher",
	["vMenu.WeaponOptions.Knife"] = "weapon_knife",
	["vMenu.WeaponOptions.KnuckleDuster"] = "weapon_knuckle",
	["vMenu.WeaponOptions.MG"] = "weapon_mg",
	["vMenu.WeaponOptions.Machete"] = "weapon_machete",
	["vMenu.WeaponOptions.MachinePistol"] = "weapon_machinepistol",
	["vMenu.WeaponOptions.MarksmanPistol"] = "weapon_marksmanpistol",
	["vMenu.WeaponOptions.MarksmanRifle"] = "weapon_marksmanrifle",
	["vMenu.WeaponOptions.MarksmanRifleMk2"] = "weapon_marksmanrifle_mk2",
	["vMenu.WeaponOptions.MicroSMG"] = "weapon_microsmg",
	["vMenu.WeaponOptions.MiniSMG"] = "weapon_minismg",
	["vMenu.WeaponOptions.Minigun"] = "weapon_minigun",
	["vMenu.WeaponOptions.Molotov"] = "weapon_molotov",
	["vMenu.WeaponOptions.Musket"] = "weapon_musket",
	["vMenu.WeaponOptions.Nightstick"] = "weapon_nightstick",
	["vMenu.WeaponOptions.Parachute"] = "gadget_parachute",
	["vMenu.WeaponOptions.PetrolCan"] = "weapon_petrolcan",
	["vMenu.WeaponOptions.PipeBomb"] = "weapon_pipebomb",
	["vMenu.WeaponOptions.Pistol"] = "weapon_pistol",
	["vMenu.WeaponOptions.Pistol50"] = "weapon_pistol50",
	["vMenu.WeaponOptions.PistolMk2"] = "weapon_pistol_mk2",
	["vMenu.WeaponOptions.PoolCue"] = "weapon_poolcue",
	["vMenu.WeaponOptions.ProximityMine"] = "weapon_proxmine",
	["vMenu.WeaponOptions.PumpShotgun"] = "weapon_pumpshotgun",
	["vMenu.WeaponOptions.PumpShotgunMk2"] = "weapon_pumpshotgun_mk2",
	["vMenu.WeaponOptions.RPG"] = "weapon_rpg",
	["vMenu.WeaponOptions.Railgun"] = "weapon_railgun",
	["vMenu.WeaponOptions.Revolver"] = "weapon_revolver",
	["vMenu.WeaponOptions.RevolverMk2"] = "weapon_revolver_mk2",
	["vMenu.WeaponOptions.SMG"] = "weapon_smg",
	["vMenu.WeaponOptions.SMGMk2"] = "weapon_smg_mk2",
	["vMenu.WeaponOptions.SNSPistol"] = "weapon_snspistol",
	["vMenu.WeaponOptions.SNSPistolMk2"] = "weapon_snspistol_mk2",
	["vMenu.WeaponOptions.SawnOffShotgun"] = "weapon_sawnoffshotgun",
	["vMenu.WeaponOptions.SmokeGrenade"] = "weapon_smokegrenade",
	["vMenu.WeaponOptions.SniperRifle"] = "weapon_sniperrifle",
	["vMenu.WeaponOptions.Snowball"] = "weapon_snowball",
	["vMenu.WeaponOptions.SpecialCarbine"] = "weapon_specialcarbine",
	["vMenu.WeaponOptions.SpecialCarbineMk2"] = "weapon_specialcarbine_mk2",
	["vMenu.WeaponOptions.StickyBomb"] = "weapon_stickybomb",
	["vMenu.WeaponOptions.StunGun"] = "weapon_stungun",
	["vMenu.WeaponOptions.SweeperShotgun"] = "weapon_autoshotgun",
	["vMenu.WeaponOptions.SwitchBlade"] = "weapon_switchblade",
	["vMenu.WeaponOptions.VintagePistol"] = "weapon_vintagepistol",
	["vMenu.WeaponOptions.Wrench"] = "weapon_wrench",
	["vMenu.WeaponOptions.PlasmaPistol"] = "weapon_raypistol",
	["vMenu.WeaponOptions.PlasmaCarbine"] = "weapon_raycarbine",
	["vMenu.WeaponOptions.PlasmaMinigun"] = "weapon_rayminigun",
	["vMenu.WeaponOptions.StoneHatchet"] = "weapon_stone_hatchet",
	["vMenu.WeaponOptions.CeramicPistol"] = "weapon_ceramicpistol",
	["vMenu.WeaponOptions.NavyRevolver"] = "weapon_navyrevolver",
	["vMenu.WeaponOptions.HazardCan"] = "weapon_hazardcan",
	["vMenu.WeaponOptions.PericoPistol"] = "weapon_gadgetpistol",
	["vMenu.WeaponOptions.MilitaryRifle"] = "weapon_militaryrifle",
	["vMenu.WeaponOptions.CombatShotgun"] = "weapon_combatshotgun",
	["vMenu.WeaponOptions.EMPLauncher"] = "weapon_emplauncher",
	["vMenu.WeaponOptions.HeavyRifle"] = "weapon_heavyrifle",
	["vMenu.WeaponOptions.FertilizerCan"] = "weapon_fertilizercan",
	["vMenu.WeaponOptions.StunGunMP"] = "weapon_stungun_mp",
	["vMenu.WeaponOptions.PrecisionRifle"] = "weapon_precisionrifle",
	["vMenu.WeaponOptions.TacticalRifle"] = "weapon_tacticalrifle",
	["vMenu.WeaponOptions.PistolXM3"] = "weapon_pistolxm3",
	["vMenu.WeaponOptions.CandyCane"] = "weapon_candycane",
	["vMenu.WeaponOptions.RailgunXM3"] = "weapon_railgunxm3",
	["vMenu.WeaponOptions.AcidPackage"] = "weapon_acidpackage",
	["vMenu.WeaponOptions.TecPistol"] = "weapon_tecpistol",
}
GetActivePlayers()
function getWeaponPerm(src)
	local a = {}
	for _, i in pairs(weaponpermtbl) do
		table.insert(a, {w=i, a=IsPlayerAceAllowed(src, _)})
	end
	return a
	
end
RegisterServerEvent("gupermcheck")
AddEventHandler("gupermcheck", function(src)
	local permroles = GetDiscordRoles(src)
	local cmds = {}
		for o, m in pairs(acetoDisc) do
			local foundRole = false
			local permdis = getDiscID(src)
			for _, i in pairs(permroles) do
				if i == o then
					foundRole = true
					for s, t in pairs(m) do
						table.insert(cmds, 'add_ace identifier.'..permdis..' "'..t..'" allow')
					end
				end
			end
			if not foundRole then
				for s, t in pairs(m) do
					table.insert(cmds, 'remove_ace identifier.'..permdis..' "'..t..'" allow')
				end
			end
		end
	local adds = {}
	local removes = {}
	for q, s in pairs(cmds) do
		if string.find(s, "add_ace") ~= nil then
			local val = string.gsub(s, "add_ace ", "")
			table.insert(adds, val)
		end
		if string.find(s, "remove_ace") ~= nil then
			local val = string.gsub(s, "remove_ace ", "")
			table.insert(removes, val)
		end
	end
	adds = removeDuplicates(adds)
	removes = removeDuplicates(removes)
	for _, i in pairs(adds) do
		for s, y in pairs(removes) do
			if i == y then
				table.remove(removes, s)
			end
		end
	end
	cmds = {}
	for _, i in pairs(adds) do
		table.insert(cmds, "add_ace "..i)
	end
	for _, i in pairs(removes) do
		table.insert(cmds, "remove_ace "..i)
	end
	for _, i in pairs(cmds) do
		ExecuteCommand(i)
	end
	TriggerClientEvent("vMenu:setupPerm", src)
	TriggerClientEvent("guperm:reset", src)
end)
lib.callback.register('guperm:getWeaponList', function(src)
    return getWeaponPerm(src)
end)
lib.callback.register('guperm:getAce', function(src, ace)
    return IsPlayerAceAllowed(src, ace)
end)
function tblprint(msg)
	print(json.encode(msg, {indent=true}))
end

function getDiscID(src)
	local a = ""
	for i = 0, GetNumPlayerIdentifiers(src) - 1 do
        local id = GetPlayerIdentifier(src, i)

        --Convert it to a nice table.
        if string.find(id, "discord") then
            a = id
        end
    end
    return a
end

function removeDuplicates(tbl)
	local finalTBL = {}
	local tblCheck = {}
	for _, i in pairs(tbl) do
		if not tblCheck[i] then
			tblCheck[i] = true
			table.insert(finalTBL, i)
		end
	end
	return finalTBL
end

RegisterServerEvent("gupermcheck:DiscordReceiving")
AddEventHandler("gupermcheck:DiscordReceiving", function(discordID)
	if matchDisRoles(discordID) then
		TriggerEvent("gupermcheck", matchDisRoles(discordID))
		TriggerEvent("guscoreboard:UpdateTBL", matchDisRoles(discordID))
	end
end)

function matchDisRoles(discorID)
	for _, playerId in ipairs(GetPlayers()) do
	  if string.gsub(getDiscID(playerId), "discord:", "") == discorID then
	  	return playerId
	  end
	end
	return false
end